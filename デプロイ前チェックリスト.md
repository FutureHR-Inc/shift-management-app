# デプロイ前チェックリスト

## ✅ ビルド確認
- ✅ ビルド成功（`npm run build` 完了）
- ✅ 型エラーなし
- ✅ リンターエラーなし

## 🔧 環境変数設定（Vercel）

以下の環境変数がVercelのプロジェクト設定に設定されていることを確認してください：

### 必須環境変数

1. **`RESEND_API_KEY`**
   - 用途: メール送信（Resend API）
   - 確認: `lib/email.ts` で必須チェックあり
   - ⚠️ 未設定の場合、アプリ起動時にエラー

2. **`NEXT_PUBLIC_SUPABASE_URL`**
   - 用途: Supabase接続URL
   - 確認: `lib/supabase.ts` で使用
   - ⚠️ 未設定の場合、データベース接続不可

3. **`NEXT_PUBLIC_SUPABASE_ANON_KEY`**
   - 用途: Supabase匿名キー
   - 確認: `lib/supabase.ts` で使用
   - ⚠️ 未設定の場合、データベース接続不可

### 推奨環境変数

4. **`NEXT_PUBLIC_APP_URL`**
   - 用途: メール内のリンクURL
   - 確認: `lib/email.ts` の各メールテンプレートで使用
   - デフォルト: `http://localhost:3000`（未設定時）
   - ⚠️ 本番環境では必ず設定（例: `https://your-app.vercel.app`）

5. **`CRON_SECRET`**（オプション）
   - 用途: Cron Job認証
   - 確認: `app/api/cron/shift-request-reminders/route.ts` で使用
   - 未設定でも動作するが、セキュリティのため推奨

## 📋 Vercel設定確認

### Cron Job設定
`vercel.json` に以下のCron Jobが設定されています：

1. **毎日のシフト通知**
   - パス: `/api/cron/daily-shift-notifications`
   - スケジュール: `0 15 * * *` (毎日15:00 UTC = 0:00 JST)

2. **シフト希望提出リマインダー**
   - パス: `/api/cron/shift-request-reminders`
   - スケジュール: `0 10 * * *` (毎日10:00 UTC = 19:00 JST)

⚠️ **注意**: VercelのCron JobはUTC時間で設定されます。JSTに合わせて調整が必要な場合は、スケジュールを変更してください。

## 🔍 デプロイ前の最終確認項目

### 1. 環境変数の確認
```bash
# Vercelダッシュボードで以下を確認：
- RESEND_API_KEY: 設定済み
- NEXT_PUBLIC_SUPABASE_URL: 設定済み
- NEXT_PUBLIC_SUPABASE_ANON_KEY: 設定済み
- NEXT_PUBLIC_APP_URL: 本番URLに設定済み
- CRON_SECRET: 設定推奨
```

### 2. データベース接続確認
- Supabaseのプロジェクトが本番環境で利用可能か
- RLS（Row Level Security）ポリシーが適切に設定されているか

### 3. メール送信設定確認
- ResendのAPIキーが有効か
- 送信者メールアドレス（`noreply@futurehrinc.com`）がResendで認証済みか

### 4. 最近の変更点確認
- ✅ 代打募集画面のスマホレイアウト調整（`app/emergency/page.tsx`）
- ✅ メール通知実装確認完了

## 🚀 デプロイ手順

1. **Gitにコミット・プッシュ**
   ```bash
   git add .
   git commit -m "デプロイ前の最終調整"
   git push origin main
   ```

2. **Vercelでのデプロイ確認**
   - Vercelダッシュボードでデプロイ状況を確認
   - ビルドログでエラーがないか確認

3. **デプロイ後の動作確認**
   - [ ] ログイン機能
   - [ ] シフト管理機能
   - [ ] 代打募集機能（スマホ表示確認）
   - [ ] メール送信機能（テスト送信）

## ⚠️ 注意事項

### メール送信について
- メール送信失敗はアプリの動作を停止させません（エラーハンドリング済み）
- ただし、メールが送信されない場合はログを確認してください

### Cron Jobについて
- VercelのCron Jobは有料プランが必要です
- 無料プランの場合は、外部のCronサービス（例: cron-job.org）を使用する必要があります

### 環境変数の更新
- 環境変数を変更した場合は、再デプロイが必要です
- Vercelダッシュボードで環境変数を更新後、手動で再デプロイを実行してください

## 📝 デプロイ後の確認

デプロイ完了後、以下を確認してください：

1. **基本動作確認**
   - トップページが表示される
   - ログインができる
   - ダッシュボードが表示される

2. **機能確認**
   - シフト作成・編集
   - 代打募集・応募
   - メール通知（テスト送信）

3. **スマホ表示確認**
   - 代打募集画面のレイアウトが正しく表示される
   - 日付とバッジが崩れていない
   - カードが適切なサイズで表示される

4. **エラーログ確認**
   - Vercelのログでエラーがないか確認
   - ブラウザのコンソールでエラーがないか確認

## 🆘 トラブルシューティング

### ビルドエラーが発生した場合
1. ローカルで `npm run build` を実行してエラーを確認
2. 型エラーがある場合は修正
3. 環境変数が不足している場合は設定

### メールが送信されない場合
1. `RESEND_API_KEY` が正しく設定されているか確認
2. ResendのダッシュボードでAPIキーの有効性を確認
3. 送信者メールアドレスが認証済みか確認

### Cron Jobが動作しない場合
1. Vercelの有料プランに加入しているか確認
2. `vercel.json` の設定が正しいか確認
3. VercelダッシュボードでCron Jobの実行履歴を確認

---

**デプロイ準備完了！** ✅

すべてのチェック項目を確認後、デプロイを実行してください。

